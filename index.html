<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Early Risk Signals - Credit Card Delinquency Watch</title>
    <link rel="stylesheet" href="website/workflow-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Tab Styles */
        .tabs-container {
            background: #ffffff;
            border-bottom: 1px solid #cbd5e1;
            padding: 0;
        }
        
        .tabs {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .tab {
            padding: 1rem 2rem;
            background: transparent;
            border: none;
            color: #64748b;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            position: relative;
        }
        
        .tab:hover {
            color: #1e293b;
            background: rgba(220, 38, 38, 0.1);
        }
        
        .tab.active {
            color: #1e293b;
            border-bottom-color: #dc2626;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Apply Form Styles */
        .apply-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 3rem 20px;
        }
        
        .form-container {
            background: #ffffff;
            border: 1px solid #cbd5e1;
            border-radius: 1rem;
            padding: 2.5rem;
            margin-bottom: 2rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .form-group input {
            background: #ffffff;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            color: #1e293b;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #8b0000;
            box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.1);
        }
        
        .form-group input:hover {
            border-color: #334155;
        }
        
        .submit-btn {
            background: #8b0000;
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
        }
        
        .submit-btn:hover {
            background: #dc143c;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 0, 0, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-container {
            background: #0f172a;
            border: 1px solid #1e293b;
            border-radius: 1rem;
            padding: 2.5rem;
            margin-top: 2rem;
            display: none;
        }
        
        .result-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-header {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #e5e7eb;
            border-left: 4px solid #8b0000;
            padding-left: 1rem;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .result-card {
            background: #020617;
            border: 1px solid #1e293b;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
        }
        
        .result-card.critical {
            border-left: 4px solid #dc143c;
        }
        
        .result-card.high {
            border-left: 4px solid #ef4444;
        }
        
        .result-card.medium {
            border-left: 4px solid #f59e0b;
        }
        
        .result-card.low {
            border-left: 4px solid #10b981;
        }
        
        .result-label {
            font-size: 0.875rem;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        
        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #e5e7eb;
        }
        
        .risk-flags {
            margin-top: 1.5rem;
        }
        
        .risk-flags h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #e5e7eb;
        }
        
        .flag-item {
            background: #020617;
            border: 1px solid #1e293b;
            border-left: 4px solid #8b0000;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .flag-item strong {
            color: #e5e7eb;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .flag-item span {
            color: #9ca3af;
            font-size: 0.875rem;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            color: #9ca3af;
        }
        
        .loading.show {
            display: block;
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            border-radius: 0.5rem;
            padding: 1rem;
            color: #ef4444;
            margin-top: 1rem;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="workflow-header">
        <div class="container">
            <h1>Early Risk Signals - Credit Card Delinquency Watch</h1>
            <p>Complete workflow visualization and risk prediction system</p>
        </div>
    </header>

    <!-- Tabs -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('workflow')">Workflow</button>
            <button class="tab" onclick="switchTab('apply')">Apply Here</button>
            <button class="tab" onclick="window.location.href='interactive-dashboard.html'">Interactive Dashboard</button>
        </div>
    </div>

    <!-- Workflow Tab Content -->
    <div id="workflow-tab" class="tab-content active">
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- Workflow Steps -->
        <div class="workflow-container">
            
            <!-- Step 1: Data Loading -->
            <div class="workflow-step" data-step="1">
                <div class="step-header">
                    <div class="step-number">01</div>
                    <div class="step-content">
                        <h2>Data Loading & Initial Analysis</h2>
                        <p class="step-subtitle">Understanding the dataset structure and characteristics</p>
                    </div>
                </div>
                <div class="step-details">
                    <div class="detail-section">
                        <h3>What We Did</h3>
                        <ul>
                            <li>Loaded <strong>Sample.csv</strong> containing 100 customer records</li>
                            <li>Analyzed 9 features: Customer ID, Credit Limit, Utilization %, Payment metrics, etc.</li>
                            <li>Identified target variable: <strong>DPD Bucket Next Month</strong> (0-3 scale)</li>
                            <li>Discovered class imbalance: 75% no risk, 25% at-risk</li>
                        </ul>
                    </div>
                    <div class="detail-section">
                        <h3>How We Did It</h3>
                        <div class="code-block">
                            <pre><code># Load data using pandas
df = pd.read_csv('Sample.csv')

# Analyze structure
print(f"Shape: {df.shape}")
print(f"Columns: {df.columns.tolist()}")
print(f"Target distribution: {df['DPD Bucket'].value_counts()}")

# Result: 100 rows × 9 columns</code></pre>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>Key Findings</h3>
                        <div class="findings-grid">
                            <div class="finding-card">
                                <div class="finding-value">100</div>
                                <div class="finding-label">Customer Records</div>
                            </div>
                            <div class="finding-card">
                                <div class="finding-value">9</div>
                                <div class="finding-label">Features</div>
                            </div>
                            <div class="finding-card">
                                <div class="finding-value">75%</div>
                                <div class="finding-label">No Risk</div>
                            </div>
                            <div class="finding-card">
                                <div class="finding-value">25%</div>
                                <div class="finding-label">At-Risk</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Feature Engineering -->
            <div class="workflow-step" data-step="2">
                <div class="step-header">
                    <div class="step-number">02</div>
                    <div class="step-content">
                        <h2>Feature Engineering - Early Warning Signals</h2>
                        <p class="step-subtitle">Creating 14+ behavioral indicators that precede delinquency</p>
                    </div>
                </div>
                <div class="step-details">
                    <div class="detail-section">
                        <h3>What We Did</h3>
                        <p>Engineered <strong>14+ new features</strong> from original data to create early warning signals. <strong>Click any card to see the code!</strong></p>
                        <div class="features-grid">
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>spending_decline_flag</h4>
                                        <p>Binary flag indicating if spending dropped significantly (decline < -15%). Early warning signal for financial stress.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['spending_decline_flag'] = (
    df['Recent Spend Change %'] < -15
).astype(int)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>spending_stress</h4>
                                        <p>Scaled indicator (0-2) of spending decline severity. 0=normal, 1=moderate (-10% to -20%), 2=severe (<-20%).</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['spending_stress'] = np.where(
    df['Recent Spend Change %'] < -20, 2,  # Severe
    np.where(df['Recent Spend Change %'] < -10, 1, 0)  # Moderate
)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>high_utilization_flag</h4>
                                        <p>Binary flag (1 if utilization ≥ 80%). Identifies customers approaching credit limit.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['high_utilization_flag'] = (
    df['Utilisation %'] >= 80
).astype(int)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>utilization_risk</h4>
                                        <p>Scaled risk indicator (0-3): 0=low, 1=medium (≥50%), 2=high (≥70%), 3=critical (≥90%).</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['utilization_risk'] = np.where(
    df['Utilisation %'] >= 90, 3,  # Critical
    np.where(df['Utilisation %'] >= 70, 2,  # High
    np.where(df['Utilisation %'] >= 50, 1, 0))  # Medium/Low
)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>low_payment_frequency</h4>
                                        <p>Binary flag (1 if payment frequency < 30%). Identifies inconsistent payment behavior.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['low_payment_frequency'] = (
    df['Min Due Paid Frequency'] < 30
).astype(int)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>payment_stress</h4>
                                        <p>Scaled indicator (0-2): 0=normal, 1=moderate (<40%), 2=severe (<20%). Measures payment consistency.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['payment_stress'] = np.where(
    df['Min Due Paid Frequency'] < 20, 2,  # Severe
    np.where(df['Min Due Paid Frequency'] < 40, 1, 0)  # Moderate
)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>payment_risk_ratio</h4>
                                        <p>Ratio of payment frequency to utilization. Lower values indicate payment capacity issues relative to credit usage.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['payment_risk_ratio'] = (
    df['Min Due Paid Frequency'] / 
    (df['Utilisation %'] + 1)
)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>high_cash_withdrawal</h4>
                                        <p>Binary flag (1 if cash withdrawal ≥ 15%). Increased cash withdrawals may indicate liquidity constraints.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['high_cash_withdrawal'] = (
    df['Cash Withdrawal %'] >= 15
).astype(int)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>cash_stress_indicator</h4>
                                        <p>Scaled indicator (0-2): 0=normal, 1=moderate (≥10%), 2=high (≥20%). Measures cash withdrawal patterns.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['cash_stress_indicator'] = np.where(
    df['Cash Withdrawal %'] >= 20, 2,  # High
    np.where(df['Cash Withdrawal %'] >= 10, 1, 0)  # Moderate
)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>narrow_merchant_mix</h4>
                                        <p>Binary flag (1 if Merchant Mix Index < 0.4). Narrow merchant mix may indicate financial constraints.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['narrow_merchant_mix'] = (
    df['Merchant Mix Index'] < 0.4
).astype(int)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>utilization_payment_mismatch</h4>
                                        <p>Composite signal: High utilization (>70%) with low payment ratio (<60%). Indicates payment capacity issues.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['utilization_payment_mismatch'] = np.where(
    (df['Utilisation %'] > 70) & 
    (df['Avg Payment Ratio'] < 60), 1, 0
)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>spending_utilization_stress</h4>
                                        <p>Composite signal: Spending decline (<-15%) combined with high utilization (>60%). High risk combination.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['spending_utilization_stress'] = np.where(
    (df['Recent Spend Change %'] < -15) & 
    (df['Utilisation %'] > 60), 1, 0
)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>payment_utilization_critical</h4>
                                        <p>Composite signal: Low payment frequency (<30%) with high utilization (>70%). Critical risk indicator.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['payment_utilization_critical'] = np.where(
    (df['Min Due Paid Frequency'] < 30) & 
    (df['Utilisation %'] > 70), 1, 0
)</code></pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flip-card" onclick="flipCard(this)">
                                <div class="flip-card-inner">
                                    <div class="flip-card-front">
                                        <h4>early_risk_score</h4>
                                        <p>Weighted combination of scaled stress indicators, normalized to 0.0-1.0. Used for risk level classification.</p>
                                    </div>
                                    <div class="flip-card-back">
                                        <h4>Code</h4>
                                        <pre><code>df['early_risk_score'] = (
    df['spending_stress'] * 0.25 +
    df['utilization_risk'] * 0.30 +
    df['payment_stress'] * 0.25 +
    df['cash_stress_indicator'] * 0.10 +
    df['narrow_merchant_mix'] * 0.10
) / 3.0</code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>How We Did It</h3>
                        <div class="code-block">
                            <pre><code># Example: Spending Stress Calculation
df['spending_stress'] = np.where(
    df['Recent Spend Change %'] < -20, 2,  # Severe
    np.where(df['Recent Spend Change %'] < -10, 1, 0)  # Moderate
)

# Example: Utilization Risk
df['utilization_risk'] = np.where(
    df['Utilisation %'] >= 90, 3,  # Critical
    np.where(df['Utilisation %'] >= 70, 2,  # High
    np.where(df['Utilisation %'] >= 50, 1, 0))  # Medium/Low
)

# Early Risk Score Calculation
# Note: Only scaled stress indicators are used in the score
# Binary flags and composite signals are used for risk flag generation
df['early_risk_score'] = (
    df['spending_stress'] * 0.25 +           # 0-2 scale
    df['utilization_risk'] * 0.30 +          # 0-3 scale
    df['payment_stress'] * 0.25 +            # 0-2 scale
    df['cash_stress_indicator'] * 0.10 +    # 0-2 scale
    df['narrow_merchant_mix'] * 0.10         # 0-1 binary
) / 3.0  # Normalize to 0-1 scale

# Binary flags (not in score, but used for flags):
# - spending_decline_flag
# - high_utilization_flag
# - low_payment_frequency
# - high_cash_withdrawal

# Composite signals (not in score, but used for flags):
# - utilization_payment_mismatch
# - spending_utilization_stress
# - payment_utilization_critical

# Additional features (not in score):
# - payment_risk_ratio</code></pre>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>Output</h3>
                        <p>Enhanced dataset with <strong>23+ columns</strong> (original 9 + 14+ engineered features)</p>
                    </div>
                </div>
            </div>

            <!-- Step 3: Risk Flag Generation -->
            <div class="workflow-step" data-step="3">
                <div class="step-header">
                    <div class="step-number">03</div>
                    <div class="step-content">
                        <h2>Risk Flag Generation</h2>
                        <p class="step-subtitle">Creating deterministic flags with clear business logic</p>
                    </div>
                </div>
                <div class="step-details">
                    <div class="detail-section">
                        <h3>What We Did</h3>
                        <p>Generated risk flags for each customer based on <strong>deterministic thresholds</strong>:</p>
                        <div class="flags-list">
                            <div class="flag-item collapsible" onclick="toggleFlag(this)">
                                <div class="flag-header">
                                    <div class="flag-title">
                                        <strong>SPENDING_DECLINE_SEVERE</strong>
                                        <span class="flag-trigger">Trigger: Spending change < -20%</span>
                                        <span class="flag-severity-badge high">HIGH</span>
                                    </div>
                                    <span class="expand-icon">▼</span>
                                </div>
                                <div class="flag-details">
                                    <p>This flag is created by analyzing the customer's recent spending behavior compared to their historical patterns. The system calculates the percentage change in spending by comparing the current month's total spending to previous periods. When a customer's spending drops by more than 20%, it indicates potential financial distress or a significant change in their financial situation. This threshold was chosen based on industry research showing that spending declines of this magnitude often precede payment difficulties. The flag is assigned a HIGH severity because sudden spending reductions can signal cash flow problems, job loss, or other financial hardships that may lead to delinquency. The system generates a personalized message showing the exact percentage decline, which helps customer service representatives understand the severity of the situation when reaching out to the customer.</p>
                                </div>
                            </div>
                            <div class="flag-item collapsible" onclick="toggleFlag(this)">
                                <div class="flag-header">
                                    <div class="flag-title">
                                        <strong>CRITICAL_UTILIZATION</strong>
                                        <span class="flag-trigger">Trigger: Utilization ≥ 90%</span>
                                        <span class="flag-severity-badge high">HIGH</span>
                                    </div>
                                    <span class="expand-icon">▼</span>
                                </div>
                                <div class="flag-details">
                                    <p>This flag monitors the customer's credit utilization ratio, which is calculated by dividing the current outstanding balance by the total credit limit and multiplying by 100. When utilization reaches or exceeds 90%, it means the customer is using nearly all of their available credit. This is a critical indicator because high utilization not only suggests financial stress but also leaves little room for unexpected expenses. The 90% threshold was selected as it represents a critical point where customers have minimal credit buffer and are at high risk of exceeding their limit or missing payments. The system tracks this metric continuously and flags customers who cross this threshold. When this flag is triggered, the system generates an alert message showing the exact utilization percentage, enabling immediate intervention. This flag is classified as HIGH severity because customers at this utilization level are statistically more likely to become delinquent within the next billing cycle.</p>
                                </div>
                            </div>
                            <div class="flag-item collapsible" onclick="toggleFlag(this)">
                                <div class="flag-header">
                                    <div class="flag-title">
                                        <strong>LOW_PAYMENT_FREQUENCY</strong>
                                        <span class="flag-trigger">Trigger: Payment frequency < 20%</span>
                                        <span class="flag-severity-badge high">HIGH</span>
                                    </div>
                                    <span class="expand-icon">▼</span>
                                </div>
                                <div class="flag-details">
                                    <p>This flag is generated by analyzing the customer's payment history over multiple billing cycles. The system calculates the percentage of times the customer has paid at least the minimum due amount on time. The payment frequency is computed by dividing the number of on-time minimum payments by the total number of billing cycles analyzed, then multiplying by 100. When this frequency drops below 20%, it means the customer is making timely minimum payments less than one-fifth of the time. This threshold indicates a pattern of inconsistent payment behavior that often precedes delinquency. The 20% threshold was chosen because customers who pay on time less than 20% of the time show a clear pattern of payment difficulties. The system tracks this metric across rolling windows to identify trends. When triggered, the flag includes the exact payment frequency percentage, helping identify customers who may need payment assistance programs or structured payment plans. This is classified as HIGH severity because payment frequency is one of the strongest predictors of future delinquency.</p>
                                </div>
                            </div>
                            <div class="flag-item collapsible" onclick="toggleFlag(this)">
                                <div class="flag-header">
                                    <div class="flag-title">
                                        <strong>PAYMENT_UTILIZATION_CRITICAL</strong>
                                        <span class="flag-trigger">Trigger: Low payment (<30%) + High util (>70%)</span>
                                        <span class="flag-severity-badge critical">CRITICAL</span>
                                    </div>
                                    <span class="expand-icon">▼</span>
                                </div>
                                <div class="flag-details">
                                    <p>This is a composite flag that combines two critical risk indicators: low payment frequency and high credit utilization. The flag is triggered when both conditions are met simultaneously: the customer's payment frequency is below 30% AND their credit utilization exceeds 70%. This combination is particularly dangerous because it indicates customers who are using most of their available credit while also struggling to make regular payments. The system creates this flag by first checking if the payment frequency metric falls below the 30% threshold, which indicates inconsistent payment behavior. Then it checks if the utilization ratio exceeds 70%, showing high credit usage. When both conditions are true, the system generates this CRITICAL severity flag. The thresholds were chosen based on statistical analysis showing that customers meeting both criteria have a significantly higher probability of becoming delinquent within 30-60 days. This composite approach allows the system to identify customers who are in the most precarious financial position, requiring immediate intervention. The flag triggers urgent outreach strategies, including phone calls within 24 hours and offers of payment plans or hardship programs.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>How We Did It</h3>
                        <div class="code-block">
                            <pre><code># Flag Generation Logic
for idx, row in df.iterrows():
    customer_flags = []
    
    # Check spending decline
    if row['Recent Spend Change %'] < -20:
        customer_flags.append({
            'flag': 'SPENDING_DECLINE_SEVERE',
            'severity': 'HIGH',
            'message': f"Spending dropped {abs(row['Recent Spend Change %'])}%",
            'action': 'Proactive payment plan discussion'
        })
    
    # Check utilization
    if row['Utilisation %'] >= 90:
        customer_flags.append({
            'flag': 'CRITICAL_UTILIZATION',
            'severity': 'HIGH',
            'message': f"Credit utilization at {row['Utilisation %']}%",
            'action': 'Immediate credit limit review'
        })
    
    # Determine overall risk level
    if any(f['severity'] == 'CRITICAL' for f in customer_flags):
        risk_level = 'CRITICAL'
    elif any(f['severity'] == 'HIGH' for f in customer_flags):
        risk_level = 'HIGH'
    # ... etc</code></pre>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>Results</h3>
                        <div class="results-grid">
                            <div class="result-card clickable-card expandable-card" onclick="toggleCustomerIds(this, 'all')" data-type="all">
                                <div class="card-header-content">
                                    <div class="result-value">50</div>
                                    <div class="result-label">Customers Flagged</div>
                                    <div class="card-hint">Click to view customer IDs</div>
                                </div>
                                <div class="card-expanded-content" style="display: none;">
                                    <div class="customer-ids-list" id="customer-ids-all"></div>
                                </div>
                            </div>
                            <div class="result-card clickable-card expandable-card critical" onclick="toggleCustomerIds(this, 'CRITICAL')" data-type="CRITICAL">
                                <div class="card-header-content">
                                    <div class="result-value">10</div>
                                    <div class="result-label">CRITICAL Risk</div>
                                    <div class="card-hint">Click to view customer IDs</div>
                                </div>
                                <div class="card-expanded-content" style="display: none;">
                                    <div class="customer-ids-list" id="customer-ids-CRITICAL"></div>
                                </div>
                            </div>
                            <div class="result-card clickable-card expandable-card high" onclick="toggleCustomerIds(this, 'HIGH')" data-type="HIGH">
                                <div class="card-header-content">
                                    <div class="result-value">40</div>
                                    <div class="result-label">HIGH Risk</div>
                                    <div class="card-hint">Click to view customer IDs</div>
                                </div>
                                <div class="card-expanded-content" style="display: none;">
                                    <div class="customer-ids-list" id="customer-ids-HIGH"></div>
                                </div>
                            </div>
                            <div class="result-card clickable-card expandable-card" onclick="toggleCustomerIds(this, 'top_flag')" data-type="top_flag">
                                <div class="card-header-content">
                                    <div class="result-value">23</div>
                                    <div class="result-label">Top Flag Count</div>
                                    <div class="card-hint">Click to view customer IDs</div>
                                </div>
                                <div class="card-expanded-content" style="display: none;">
                                    <div class="customer-ids-list" id="customer-ids-top_flag"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Model Training -->
            <div class="workflow-step" data-step="4">
                <div class="step-header">
                    <div class="step-number">04</div>
                    <div class="step-content">
                        <h2>Predictive Model Training</h2>
                        <p class="step-subtitle">Training multiple ML models to validate early signals</p>
                    </div>
                </div>
                <div class="step-details">
                    <div class="detail-section">
                        <h3>What We Did</h3>
                        <p>Trained <strong>3 machine learning models</strong> to predict at-risk customers:</p>
                        <div class="models-grid">
                            <div class="model-card">
                                <h4>1. Random Forest</h4>
                                <ul>
                                    <li>100 estimators</li>
                                    <li>Max depth: 5</li>
                                    <li>Class weight: balanced</li>
                                    <li><strong>Accuracy: 75%</strong></li>
                                </ul>
                            </div>
                            <div class="model-card">
                                <h4>2. Logistic Regression</h4>
                                <ul>
                                    <li>L2 regularization</li>
                                    <li>Class weight: balanced</li>
                                    <li>Max iterations: 1000</li>
                                    <li><strong>Accuracy: 55%</strong></li>
                                </ul>
                            </div>
                            <div class="model-card">
                                <h4>3. Gradient Boosting</h4>
                                <ul>
                                    <li>100 estimators</li>
                                    <li>Max depth: 3</li>
                                    <li>Learning rate: default</li>
                                    <li><strong>Accuracy: 65%</strong></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>How We Did It</h3>
                        <div class="code-block">
                            <pre><code># Prepare features
feature_cols = [
    'Utilisation %', 'Avg Payment Ratio', 'Min Due Paid Frequency',
    'Merchant Mix Index', 'Cash Withdrawal %', 'Recent Spend Change %',
    'spending_stress', 'utilization_risk', 'payment_stress',
    'cash_stress_indicator', 'utilization_payment_mismatch',
    'spending_utilization_stress', 'payment_utilization_critical'
]

X = df[feature_cols]
y = (df['DPD Bucket Next Month'] > 0).astype(int)  # Binary target

# Train-test split (80/20)
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)

# Scale features
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

# Train Random Forest
model = RandomForestClassifier(
    n_estimators=100,
    max_depth=5,
    min_samples_split=10,
    random_state=42,
    class_weight='balanced'
)
model.fit(X_train_scaled, y_train)

# Evaluate
y_pred = model.predict(X_test_scaled)
accuracy = accuracy_score(y_test, y_pred)</code></pre>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>Top Features</h3>
                        <ol class="feature-list">
                            <li>Min Due Paid Frequency (18.3% importance)</li>
                            <li>Utilisation % (17.5% importance)</li>
                            <li>Recent Spend Change % (13.7% importance)</li>
                            <li>Avg Payment Ratio (11.7% importance)</li>
                            <li>Merchant Mix Index (11.2% importance)</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Step 5: Outreach Strategies -->
            <div class="workflow-step" data-step="5">
                <div class="step-header">
                    <div class="step-number">05</div>
                    <div class="step-content">
                        <h2>Outreach Strategy Generation</h2>
                        <p class="step-subtitle">Creating actionable intervention plans for each customer</p>
                    </div>
                </div>
                <div class="step-details">
                    <div class="detail-section">
                        <h3>What We Did</h3>
                        <p>Generated <strong>personalized outreach strategies</strong> based on risk level:</p>
                        
                        <!-- Dynamic Controls Panel -->
                        <div class="strategy-controls">
                            <h4>Adjust Outreach Parameters</h4>
                            <div class="controls-grid">
                                <div class="control-group">
                                    <label for="critical-timing">CRITICAL Risk Timing (hours):</label>
                                    <input type="number" id="critical-timing" min="1" max="168" value="24" step="1">
                                    <span class="control-hint">Default: 24 hours</span>
                                </div>
                                <div class="control-group">
                                    <label for="critical-channel">CRITICAL Risk Channel:</label>
                                    <select id="critical-channel">
                                        <option value="Phone Call">Phone Call</option>
                                        <option value="Phone Call or Email">Phone Call or Email</option>
                                        <option value="Email">Email</option>
                                        <option value="SMS">SMS</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label for="high-timing">HIGH Risk Timing (hours):</label>
                                    <input type="number" id="high-timing" min="1" max="168" value="48" step="1">
                                    <span class="control-hint">Default: 48 hours</span>
                                </div>
                                <div class="control-group">
                                    <label for="high-channel">HIGH Risk Channel:</label>
                                    <select id="high-channel">
                                        <option value="Phone Call or Email">Phone Call or Email</option>
                                        <option value="Phone Call">Phone Call</option>
                                        <option value="Email">Email</option>
                                        <option value="SMS">SMS</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label for="medium-timing">MEDIUM Risk Timing (hours):</label>
                                    <input type="number" id="medium-timing" min="1" max="168" value="168" step="1">
                                    <span class="control-hint">Default: 168 hours (1 week)</span>
                                </div>
                                <div class="control-group">
                                    <label for="medium-channel">MEDIUM Risk Channel:</label>
                                    <select id="medium-channel">
                                        <option value="Email or SMS">Email or SMS</option>
                                        <option value="Email">Email</option>
                                        <option value="SMS">SMS</option>
                                        <option value="Phone Call">Phone Call</option>
                                    </select>
                                </div>
                            </div>
                            <div class="control-buttons">
                                <button class="change-btn" onclick="updateStrategies()">Change</button>
                                <button class="reset-btn" onclick="resetStrategies()">Reset to Defaults</button>
                            </div>
                        </div>
                        
                        <div class="strategy-grid">
                            <div class="strategy-card critical">
                                <h4>CRITICAL Risk</h4>
                                <ul>
                                    <li><strong>Channel:</strong> <span id="critical-channel-display">Phone Call</span></li>
                                    <li><strong>Timing:</strong> <span id="critical-timing-display">Within 24 hours</span></li>
                                    <li><strong>Message:</strong> Urgent intervention required</li>
                                    <li><strong>Offer:</strong> Payment plan, hardship program</li>
                                </ul>
                                <div class="strategy-count">10 customers</div>
                            </div>
                            <div class="strategy-card high">
                                <h4>HIGH Risk</h4>
                                <ul>
                                    <li><strong>Channel:</strong> <span id="high-channel-display">Phone Call or Email</span></li>
                                    <li><strong>Timing:</strong> <span id="high-timing-display">Within 48 hours</span></li>
                                    <li><strong>Message:</strong> Proactive support offer</li>
                                    <li><strong>Offer:</strong> Payment plan, counseling</li>
                                </ul>
                                <div class="strategy-count">40 customers</div>
                            </div>
                            <div class="strategy-card medium">
                                <h4>MEDIUM Risk</h4>
                                <ul>
                                    <li><strong>Channel:</strong> <span id="medium-channel-display">Email or SMS</span></li>
                                    <li><strong>Timing:</strong> <span id="medium-timing-display">Within 1 week</span></li>
                                    <li><strong>Message:</strong> Educational resources</li>
                                    <li><strong>Offer:</strong> Tips and reminders</li>
                                </ul>
                                <div class="strategy-count">19 customers</div>
                            </div>
                        </div>
                    </div>
                    <div class="detail-section">
                        <h3>How We Did It</h3>
                        <div class="code-block">
                            <pre><code># Strategy Generation with Dynamic Parameters
# Configuration parameters (adjustable by administrators)
OUTREACH_CONFIG = {
    'CRITICAL': {
        'timing_hours': 24,  # Default: 24 hours (adjustable 1-168)
        'channel': 'Phone Call'  # Default: Phone Call (adjustable)
    },
    'HIGH': {
        'timing_hours': 48,  # Default: 48 hours (adjustable 1-168)
        'channel': 'Phone Call or Email'  # Default: Phone Call or Email (adjustable)
    },
    'MEDIUM': {
        'timing_hours': 168,  # Default: 168 hours / 1 week (adjustable 1-168)
        'channel': 'Email or SMS'  # Default: Email or SMS (adjustable)
    }
}

def format_timing(hours):
    """Format hours into human-readable timing string"""
    if hours < 24:
        return f'Within {hours} hour{"s" if hours > 1 else ""}'
    elif hours < 168:
        days = hours // 24
        remaining_hours = hours % 24
        if remaining_hours == 0:
            return f'Within {days} day{"s" if days > 1 else ""}'
        else:
            return f'Within {days} day{"s" if days > 1 else ""} and {remaining_hours} hour{"s" if remaining_hours > 1 else ""}'
    else:
        weeks = hours // 168
        remaining_days = (hours % 168) // 24
        if remaining_days == 0:
            return f'Within {weeks} week{"s" if weeks > 1 else ""}'
        else:
            return f'Within {weeks} week{"s" if weeks > 1 else ""} and {remaining_days} day{"s" if remaining_days > 1 else ""}'

for idx, row in risk_flags_df.iterrows():
    strategies = []
    risk_level = row['risk_level']
    
    # Base strategy by risk level (using dynamic config)
    if risk_level == 'CRITICAL':
        config = OUTREACH_CONFIG['CRITICAL']
        strategies.append({
            'priority': 1,
            'channel': config['channel'],  # Dynamic: from config
            'timing': format_timing(config['timing_hours']),  # Dynamic: formatted timing
            'message': 'Urgent: We noticed concerning patterns in your account. Let\'s discuss payment options.',
            'offer': 'Payment plan, hardship program, or credit limit adjustment'
        })
    elif risk_level == 'HIGH':
        config = OUTREACH_CONFIG['HIGH']
        strategies.append({
            'priority': 2,
            'channel': config['channel'],  # Dynamic: from config
            'timing': format_timing(config['timing_hours']),  # Dynamic: formatted timing
            'message': 'We\'re here to help. Let\'s review your account and explore options.',
            'offer': 'Payment plan or financial counseling'
        })
    elif risk_level == 'MEDIUM':
        config = OUTREACH_CONFIG['MEDIUM']
        strategies.append({
            'priority': 3,
            'channel': config['channel'],  # Dynamic: from config
            'timing': format_timing(config['timing_hours']),  # Dynamic: formatted timing
            'message': 'Tips for managing your credit card account effectively.',
            'offer': 'Educational resources and payment reminders'
        })
    
    # Flag-specific strategies
    for flag in row['flags']:
        if flag['flag'] == 'SPENDING_DECLINE_SEVERE':
            strategies.append({
                'priority': 1,
                'channel': 'Phone Call',
                'timing': format_timing(OUTREACH_CONFIG[risk_level]['timing_hours']),
                'message': 'We noticed a significant change in your spending patterns.',
                'offer': 'Financial wellness check-in and budgeting tools'
            })
    
    return strategies</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 6: Visualizations -->
            <div class="workflow-step" data-step="6">
                <div class="step-header">
                    <div class="step-number">06</div>
                    <div class="step-content">
                        <h2>Visualization Creation</h2>
                        <p class="step-subtitle">Generating 9 comprehensive charts and dashboards</p>
                    </div>
                </div>
                <div class="step-details">
                    <div class="detail-section">
                        <h3>What We Did</h3>
                        <p>Created <strong>9 professional visualizations</strong> using matplotlib and seaborn:</p>
                    </div>
                    
                    <!-- Visualization 1: Model Comparison -->
                    <div class="detail-section">
                        <h3>1. Model Performance Comparison</h3>
                        <p>Comparison of three machine learning models showing accuracy and ROC-AUC scores.</p>
                        <div class="viz-image-container">
                            <img src="../visualizations/model_comparison.png" alt="Model Comparison" class="workflow-viz-image">
                        </div>
                        <p class="viz-description">Line graphs comparing Random Forest, Logistic Regression, and Gradient Boosting models. Random Forest achieved the highest accuracy of 75%.</p>
                    </div>

                    <!-- Visualization 2: Dataset Comparison -->
                    <div class="detail-section">
                        <h3>2. Dataset Size Impact Analysis</h3>
                        <p>Performance comparison between original dataset (100 records) and synthetic dataset (50,000 records).</p>
                        <div class="viz-image-container">
                            <img src="visualizations/dataset_comparison.png" alt="Dataset Comparison" class="workflow-viz-image">
                        </div>
                        <p class="viz-description">Shows how model performance changes with dataset size. Gradient Boosting improved significantly with larger dataset, achieving 79% accuracy.</p>
                    </div>

                    <!-- Visualization 3: Risk Distribution -->
                    <div class="detail-section">
                        <h3>3. Portfolio Risk Distribution</h3>
                        <p>Distribution of risk levels across the customer portfolio.</p>
                        <div class="viz-image-container">
                            <img src="visualizations/risk_distribution.png" alt="Risk Distribution" class="workflow-viz-image">
                        </div>
                        <p class="viz-description">Bar chart showing risk level breakdown and histogram of risk score distribution. 50% of customers flagged as at-risk.</p>
                    </div>

                    <!-- Visualization 4: Behavioral Patterns -->
                    <div class="detail-section">
                        <h3>4. Behavioral Pattern Analysis</h3>
                        <p>Key behavioral patterns that precede delinquency.</p>
                        <div class="viz-image-container">
                            <img src="visualizations/behavioral_patterns.png" alt="Behavioral Patterns" class="workflow-viz-image">
                        </div>
                        <p class="viz-description">Four scatter plots showing correlations: Spending Change vs Utilization, Payment Frequency vs Utilization, Cash Withdrawal patterns, and Early Risk Score by DPD bucket.</p>
                    </div>

                    <!-- Visualization 5: Flag Frequency -->
                    <div class="detail-section">
                        <h3>5. Early Warning Flag Frequency</h3>
                        <p>Most common early warning signals across the portfolio.</p>
                        <div class="viz-image-container">
                            <img src="visualizations/flag_frequency.png" alt="Flag Frequency" class="workflow-viz-image">
                        </div>
                        <p class="viz-description">Horizontal bar chart showing frequency of each risk flag. Low Payment Frequency (23 customers) and Spending Decline (20 customers) are top indicators.</p>
                    </div>

                    <!-- Visualization 6: Feature Importance -->
                    <div class="detail-section">
                        <h3>6. Feature Importance Analysis</h3>
                        <p>Top predictive features from the Random Forest model.</p>
                        <div class="viz-image-container">
                            <img src="visualizations/feature_importance.png" alt="Feature Importance" class="workflow-viz-image">
                        </div>
                        <p class="viz-description">Bar chart showing top 10 most important features. Payment Frequency (18.3%) and Utilization (17.5%) are strongest predictors.</p>
                    </div>

                    <!-- Visualization 7: Outreach Strategy -->
                    <div class="detail-section">
                        <h3>7. Outreach Strategy Distribution</h3>
                        <p>Distribution of intervention strategies by channel and priority level.</p>
                        <div class="viz-image-container">
                            <img src="visualizations/outreach_strategy.png" alt="Outreach Strategy" class="workflow-viz-image">
                        </div>
                        <p class="viz-description">Bar charts showing outreach channel distribution and intervention priority levels. 10 customers require immediate phone calls.</p>
                    </div>

                    <!-- Visualization 8: Risk Heatmap -->
                    <div class="detail-section">
                        <h3>8. Risk Factors Correlation Heatmap</h3>
                        <p>Correlation matrix showing relationships between different risk factors.</p>
                        <div class="viz-image-container">
                            <img src="visualizations/risk_heatmap.png" alt="Risk Heatmap" class="workflow-viz-image">
                        </div>
                        <p class="viz-description">Heatmap showing correlations between 10 key risk factors. Strong correlations help identify which factors work together to predict delinquency.</p>
                    </div>

                    <!-- Visualization 9: Workflow Diagram -->
                    <div class="detail-section">
                        <h3>9. System Workflow Diagram</h3>
                        <p>Complete workflow of the Early Risk Signal System.</p>
                        <div class="viz-image-container">
                            <img src="visualizations/workflow_diagram.png" alt="Workflow Diagram" class="workflow-viz-image">
                        </div>
                        <p class="viz-description">Visual workflow showing data flow from input through risk flag generation to automated outreach strategies. Shows decision tree routing for different risk levels.</p>
                    </div>

                    <div class="detail-section">
                        <h3>How We Did It</h3>
                        <div class="code-block">
                            <pre><code># Example: Risk Distribution Chart
fig, axes = plt.subplots(1, 2, figsize=(16, 6))

# Risk level distribution
risk_counts = risk_flags_df['risk_level'].value_counts()
axes[0].bar(risk_counts.index, risk_counts.values, 
           color=['green', 'orange', 'red', 'darkred'])

# Risk score distribution
axes[1].hist(risk_flags_df['risk_score'], bins=20, color='blue')
axes[1].axvline(risk_flags_df['risk_score'].mean(), 
               color='red', linestyle='--')

plt.savefig('risk_distribution.png', dpi=300)</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 7: Synthetic Dataset Display -->
            <div class="workflow-step" data-step="7">
                <div class="step-header">
                    <div class="step-number">07</div>
                    <div class="step-content">
                        <h2>Dataset Viewer</h2>
                        <p class="step-subtitle">View and explore the datasets used for model training and evaluation</p>
                    </div>
                </div>
                <div class="step-details">
                    <div class="detail-section">
                        <h3>Dataset Selection</h3>
                        <div style="margin-bottom: 1.5rem; display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem 1rem; background: #1e293b; border-radius: 8px; border: 2px solid #334155; transition: all 0.3s ease;">
                                <input type="radio" name="dataset-type" value="real" id="dataset-real" checked onchange="switchDataset('real')" style="cursor: pointer;">
                                <span>Real Dataset (100 records)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem 1rem; background: #1e293b; border-radius: 8px; border: 2px solid #334155; transition: all 0.3s ease;">
                                <input type="radio" name="dataset-type" value="synthetic" id="dataset-synthetic" onchange="switchDataset('synthetic')" style="cursor: pointer;">
                                <span>Synthetic Dataset (50,000 records)</span>
                            </label>
                        </div>
                        
                        <h3>Dataset Overview</h3>
                        <p id="dataset-description">This dataset displays <strong>all 100 customer records</strong> from the original sample dataset. Use the controls below to explore the data.</p>
                        <div style="margin-top: 1rem; margin-bottom: 1rem;">
                            <button class="action-btn" id="download-btn" onclick="downloadFullDataset(event)" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); padding: 0.75rem 1.5rem; font-size: 1rem; border: none; cursor: pointer; border-radius: 8px; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(220, 38, 38, 0.3);">
                                📥 Download Full Dataset (100 records)
                            </button>
                        </div>
                        
                        <div class="dataset-controls">
                            <div class="control-group">
                                <label for="search-input">Search:</label>
                                <input type="text" id="search-input" placeholder="Search by Customer ID, values..." onkeyup="filterDataset()">
                            </div>
                            <div class="control-group">
                                <label for="rows-per-page">Rows per page:</label>
                                <select id="rows-per-page" onchange="changeRowsPerPage()">
                                    <option value="10">10</option>
                                    <option value="25" selected>25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <span id="dataset-info">Loading dataset...</span>
                            </div>
                        </div>
                        
                        <div class="dataset-container">
                            <div id="loading-indicator" style="text-align: center; padding: 2rem; color: #9ca3af;">
                                <p>Loading dataset (1,000 records)...</p>
                                <div style="margin-top: 1rem;">
                                    <div style="display: inline-block; width: 200px; height: 4px; background: #1e293b; border-radius: 2px; overflow: hidden;">
                                        <div id="loading-bar" style="width: 0%; height: 100%; background: #8b0000; transition: width 0.3s ease;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="table-wrapper" id="table-wrapper" style="display: none;">
                                <table id="dataset-table" class="dataset-table">
                                    <thead>
                                        <tr>
                                            <th>Customer ID</th>
                                            <th>Credit Limit</th>
                                            <th>Utilisation %</th>
                                            <th>Avg Payment Ratio</th>
                                            <th>Min Due Paid Frequency</th>
                                            <th>Merchant Mix Index</th>
                                            <th>Cash Withdrawal %</th>
                                            <th>Recent Spend Change %</th>
                                            <th>DPD Bucket Next Month</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dataset-tbody">
                                        <tr><td colspan="9" style="text-align: center; padding: 2rem;">Loading dataset...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination-controls">
                                <button id="prev-page" onclick="changePage(-1)" disabled>← Previous</button>
                                <span id="page-info">Page 1 of 1</span>
                                <button id="next-page" onclick="changePage(1)" disabled>Next →</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 8: Output Generation -->
            <div class="workflow-step" data-step="8">
                <div class="step-header">
                    <div class="step-number">08</div>
                    <div class="step-content">
                        <h2>Output Files & Documentation</h2>
                        <p class="step-subtitle">Generating comprehensive outputs and documentation</p>
                    </div>
                </div>
                <div class="step-details">
                    <div class="detail-section">
                        <h3>What We Created</h3>
                        <div class="outputs-grid">
                            <div class="output-card">
                                <h4>CSV Files (3)</h4>
                                <ul>
                                    <li><code>risk_flags_output.csv</code> - Risk flags for 100 customers</li>
                                    <li><code>outreach_strategies.csv</code> - Intervention recommendations</li>
                                    <li><code>data_with_early_signals.csv</code> - Enhanced dataset</li>
                                </ul>
                            </div>
                            <div class="output-card">
                                <h4>Visualizations (9)</h4>
                                <ul>
                                    <li>All PNG files saved with 300 DPI</li>
                                    <li>Professional styling and formatting</li>
                                    <li>Ready for presentations</li>
                                </ul>
                            </div>
                            <div class="output-card">
                                <h4>Documentation (5)</h4>
                                <ul>
                                    <li><code>README.md</code> - User guide</li>
                                    <li><code>solution_narrative.md</code> - Complete documentation</li>
                                    <li><code>EXECUTIVE_SUMMARY.md</code> - Executive overview</li>
                                    <li><code>FULL_WORKFLOW.md</code> - Workflow details</li>
                                    <li><code>EXECUTION_TRANSCRIPT.md</code> - Execution log</li>
                                </ul>
                            </div>
                            <div class="output-card">
                                <h4>Website</h4>
                                <ul>
                                    <li><code>index.html</code> - Main website</li>
                                    <li><code>styles.css</code> - Dark theme styling</li>
                                    <li><code>workflow.html</code> - This interactive page</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary -->
            <div class="workflow-summary">
                <h2>Complete Workflow Summary</h2>
                <div class="summary-stats">
                    <div class="summary-stat">
                        <div class="stat-number">8</div>
                        <div class="stat-label">Major Steps</div>
                    </div>
                    <div class="summary-stat">
                        <div class="stat-number">14+</div>
                        <div class="stat-label">Features Engineered</div>
                    </div>
                    <div class="summary-stat">
                        <div class="stat-number">3</div>
                        <div class="stat-label">ML Models Trained</div>
                    </div>
                    <div class="summary-stat">
                        <div class="stat-number">9</div>
                        <div class="stat-label">Visualizations</div>
                    </div>
                    <div class="summary-stat">
                        <div class="stat-number">32</div>
                        <div class="stat-label">Files Generated</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="workflow-nav">
            <button class="nav-btn" id="prevBtn" onclick="navigateStep(-1)">← Previous</button>
            <button class="nav-btn" id="nextBtn" onclick="navigateStep(1)">Next →</button>
        </div>
    </div>

    <!-- Apply Here Tab Content -->
    <div id="apply-tab" class="tab-content">
        <div class="apply-container">
            <div class="form-container">
                <form id="predictionForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="customer_id">Customer ID</label>
                            <input type="text" id="customer_id" name="customer_id" placeholder="e.g., C001" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="credit_limit">Credit Limit</label>
                            <input type="number" id="credit_limit" name="credit_limit" placeholder="e.g., 165000" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="utilisation">Utilisation %</label>
                            <input type="number" id="utilisation" name="utilisation" placeholder="e.g., 12" min="0" max="100" step="0.1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="avg_payment_ratio">Avg Payment Ratio</label>
                            <input type="number" id="avg_payment_ratio" name="avg_payment_ratio" placeholder="e.g., 32" min="0" max="100" step="0.1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="min_due_frequency">Min Due Paid Frequency %</label>
                            <input type="number" id="min_due_frequency" name="min_due_frequency" placeholder="e.g., 66" min="0" max="100" step="0.1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="merchant_mix">Merchant Mix Index</label>
                            <input type="number" id="merchant_mix" name="merchant_mix" placeholder="e.g., 0.73" min="0" max="1" step="0.01" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="cash_withdrawal">Cash Withdrawal %</label>
                            <input type="number" id="cash_withdrawal" name="cash_withdrawal" placeholder="e.g., 12" min="0" max="100" step="0.1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="spend_change">Recent Spend Change %</label>
                            <input type="number" id="spend_change" name="spend_change" placeholder="e.g., -21" min="-100" max="100" step="0.1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="dpd_bucket">DPD Bucket Next Month (Optional)</label>
                            <input type="number" id="dpd_bucket" name="dpd_bucket" placeholder="e.g., 3 (0-3)" min="0" max="3" step="1">
                            <small style="color: #9ca3af; font-size: 0.75rem; margin-top: 0.25rem;">Leave empty for prediction only</small>
                        </div>
                    </div>
                    
                    <button type="submit" class="submit-btn" id="submitBtn">Predict Risk</button>
                </form>
                
                <div class="loading" id="loading">
                    <p>Processing prediction...</p>
                </div>
                
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-container" id="resultContainer">
                <div class="result-header">Prediction Results</div>
                
                <div class="result-grid">
                    <div class="result-card" id="riskLevelCard">
                        <div class="result-label">Risk Level</div>
                        <div class="result-value" id="riskLevel">-</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">Risk Score</div>
                        <div class="result-value" id="riskScore">-</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">Prediction</div>
                        <div class="result-value" id="prediction">-</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">Probability</div>
                        <div class="result-value" id="probability">-</div>
                    </div>
                </div>
                
                <div class="risk-flags" id="riskFlags">
                    <h3>Early Warning Flags</h3>
                    <div id="flagsList"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="website/workflow-script.js"></script>
    <script src="website/ml-model-predictor.js"></script>
    <script src="website/apply-script.js"></script>
    <script>
        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        // Collapsible flag functionality
        function toggleFlag(element) {
            element.classList.toggle('expanded');
            const icon = element.querySelector('.expand-icon');
            if (element.classList.contains('expanded')) {
                icon.textContent = '▲';
            } else {
                icon.textContent = '▼';
            }
        }
        
        // Dynamic strategy update functionality
        function updateStrategies() {
            // Get values from controls
            const criticalTiming = parseInt(document.getElementById('critical-timing').value);
            const criticalChannel = document.getElementById('critical-channel').value;
            const highTiming = parseInt(document.getElementById('high-timing').value);
            const highChannel = document.getElementById('high-channel').value;
            const mediumTiming = parseInt(document.getElementById('medium-timing').value);
            const mediumChannel = document.getElementById('medium-channel').value;
            
            // Format timing display
            function formatTiming(hours) {
                if (hours < 24) {
                    return `Within ${hours} hour${hours > 1 ? 's' : ''}`;
                } else if (hours < 168) {
                    const days = Math.floor(hours / 24);
                    const remainingHours = hours % 24;
                    if (remainingHours === 0) {
                        return `Within ${days} day${days > 1 ? 's' : ''}`;
                    } else {
                        return `Within ${days} day${days > 1 ? 's' : ''} and ${remainingHours} hour${remainingHours > 1 ? 's' : ''}`;
                    }
                } else {
                    const weeks = Math.floor(hours / 168);
                    const remainingDays = Math.floor((hours % 168) / 24);
                    if (remainingDays === 0) {
                        return `Within ${weeks} week${weeks > 1 ? 's' : ''}`;
                    } else {
                        return `Within ${weeks} week${weeks > 1 ? 's' : ''} and ${remainingDays} day${remainingDays > 1 ? 's' : ''}`;
                    }
                }
            }
            
            // Update displays
            document.getElementById('critical-timing-display').textContent = formatTiming(criticalTiming);
            document.getElementById('critical-channel-display').textContent = criticalChannel;
            document.getElementById('high-timing-display').textContent = formatTiming(highTiming);
            document.getElementById('high-channel-display').textContent = highChannel;
            document.getElementById('medium-timing-display').textContent = formatTiming(mediumTiming);
            document.getElementById('medium-channel-display').textContent = mediumChannel;
        }
        
        // Reset to defaults
        function resetStrategies() {
            document.getElementById('critical-timing').value = 24;
            document.getElementById('critical-channel').value = 'Phone Call';
            document.getElementById('high-timing').value = 48;
            document.getElementById('high-channel').value = 'Phone Call or Email';
            document.getElementById('medium-timing').value = 168;
            document.getElementById('medium-channel').value = 'Email or SMS';
            updateStrategies();
        }
        
        // Flip card functionality
        function flipCard(element) {
            element.classList.toggle('flipped');
        }
        
        // Dataset display functionality
        let datasetData = [];
        let filteredData = [];
        let currentPage = 1;
        let rowsPerPage = 25;
        let currentDatasetType = 'real'; // 'real' or 'synthetic'
        
        // Switch between datasets
        async function switchDataset(type) {
            currentDatasetType = type;
            currentPage = 1; // Reset to first page
            
            // Update UI elements
            const descriptionEl = document.getElementById('dataset-description');
            const downloadBtn = document.getElementById('download-btn');
            const loadingIndicator = document.getElementById('loading-indicator');
            const loadingText = loadingIndicator.querySelector('p');
            
            if (type === 'real') {
                descriptionEl.innerHTML = 'This dataset displays <strong>all 100 customer records</strong> from the original sample dataset. Use the controls below to explore the data.';
                downloadBtn.innerHTML = '📥 Download Full Dataset (100 records)';
                loadingText.textContent = 'Loading dataset (100 records)...';
            } else {
                descriptionEl.innerHTML = 'This synthetic dataset displays the <strong>first 1,000 customer records</strong> from the full 50,000 record dataset. Use the controls below to explore the data.';
                downloadBtn.innerHTML = '📥 Download Full Dataset (50,000 records)';
                loadingText.textContent = 'Loading dataset (1,000 records)...';
            }
            
            // Show loading indicator
            loadingIndicator.style.display = 'block';
            document.getElementById('table-wrapper').style.display = 'none';
            document.getElementById('loading-bar').style.width = '0%';
            
            // Load the selected dataset
            await loadDataset(type);
        }
        
        // Load dataset
        async function loadDataset(type = currentDatasetType) {
            try {
                // Determine file path based on dataset type
                const fileName = type === 'real' ? 'Sample.csv' : 'synthetic_dataset_50000.csv';
                const maxRows = type === 'real' ? 100 : 1000; // Load all real data, first 1000 synthetic
                
                // Try multiple possible paths
                const possiblePaths = [
                    `data/${fileName}`,
                    `./data/${fileName}`,
                    `../data/${fileName}`
                ];
                
                let response = null;
                let lastError = null;
                
                for (const path of possiblePaths) {
                    try {
                        response = await fetch(path);
                        if (response.ok) {
                            console.log(`Successfully loading dataset from: ${path}`);
                            break;
                        }
                    } catch (err) {
                        lastError = err;
                        continue;
                    }
                }
                
                if (!response || !response.ok) {
                    throw new Error(`Failed to load dataset. Status: ${response ? response.status : 'No response'}`);
                }
                
                const text = await response.text();
                const lines = text.split('\n').filter(line => line.trim());
                
                if (lines.length === 0) {
                    throw new Error('Dataset file is empty');
                }
                
                const headers = lines[0].split(',').map(h => h.trim());
                const totalLines = Math.min(lines.length - 1, maxRows);
                
                datasetData = [];
                // Process in chunks to show progress
                const chunkSize = type === 'real' ? 20 : 100; // Smaller chunks for real dataset
                for (let chunkStart = 1; chunkStart <= totalLines + 1; chunkStart += chunkSize) {
                    const chunkEnd = Math.min(chunkStart + chunkSize, totalLines + 1);
                    
                    for (let i = chunkStart; i < chunkEnd; i++) {
                        if (lines[i] && lines[i].trim()) {
                            // Handle CSV parsing more carefully (account for commas in quoted fields)
                            const values = parseCSVLine(lines[i]);
                            if (values.length >= headers.length) {
                                datasetData.push({
                                    'Customer ID': values[0]?.trim() || '',
                                    'Credit Limit': parseFloat(values[1]) || 0,
                                    'Utilisation %': parseFloat(values[2]) || 0,
                                    'Avg Payment Ratio': parseFloat(values[3]) || 0,
                                    'Min Due Paid Frequency': parseFloat(values[4]) || 0,
                                    'Merchant Mix Index': parseFloat(values[5]) || 0,
                                    'Cash Withdrawal %': parseFloat(values[6]) || 0,
                                    'Recent Spend Change %': parseFloat(values[7]) || 0,
                                    'DPD Bucket Next Month': parseInt(values[8]) || 0
                                });
                            }
                        }
                    }
                    
                    // Update loading progress
                    const progress = ((chunkEnd - 1) / totalLines) * 100;
                    document.getElementById('loading-bar').style.width = Math.min(progress, 100) + '%';
                    
                    // Allow UI to update
                    await new Promise(resolve => setTimeout(resolve, 0));
                }
                
                if (datasetData.length === 0) {
                    throw new Error('No data rows found in dataset');
                }
                
                filteredData = [...datasetData];
                document.getElementById('dataset-info').textContent = `Total records: ${datasetData.length.toLocaleString()}`;
                
                // Hide loading indicator and show table
                document.getElementById('loading-indicator').style.display = 'none';
                document.getElementById('table-wrapper').style.display = 'block';
                
                renderTable();
            } catch (error) {
                console.error('Error loading dataset:', error);
                const errorMsg = error.message || 'Unknown error';
                const fileName = type === 'real' ? 'Sample.csv' : 'synthetic_dataset_50000.csv';
                document.getElementById('dataset-tbody').innerHTML = 
                    `<tr><td colspan="9" style="text-align: center; padding: 2rem; color: #ef4444;">
                        Error loading dataset: ${errorMsg}<br>
                        <small style="color: #9ca3af;">Please ensure the file exists at: data/${fileName}</small>
                    </td></tr>`;
                document.getElementById('dataset-info').textContent = 'Error loading dataset';
            }
        }
        
        // Helper function to parse CSV line (handles quoted fields)
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            
            return result;
        }
        
        function filterDataset() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            if (!searchTerm) {
                filteredData = [...datasetData];
            } else {
                filteredData = datasetData.filter(row => {
                    return Object.values(row).some(val => 
                        String(val).toLowerCase().includes(searchTerm)
                    );
                });
            }
            currentPage = 1;
            renderTable();
            updateDatasetInfo();
        }
        
        function changeRowsPerPage() {
            rowsPerPage = parseInt(document.getElementById('rows-per-page').value);
            currentPage = 1;
            renderTable();
        }
        
        function changePage(direction) {
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            currentPage += direction;
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            renderTable();
        }
        
        function renderTable() {
            const tbody = document.getElementById('dataset-tbody');
            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const pageData = filteredData.slice(start, end);
            
            if (pageData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 2rem;">No data found</td></tr>';
                return;
            }
            
            tbody.innerHTML = pageData.map(row => `
                <tr>
                    <td>${row['Customer ID']}</td>
                    <td>${row['Credit Limit'].toLocaleString()}</td>
                    <td>${row['Utilisation %'].toFixed(1)}%</td>
                    <td>${row['Avg Payment Ratio'].toFixed(1)}%</td>
                    <td>${row['Min Due Paid Frequency'].toFixed(1)}%</td>
                    <td>${row['Merchant Mix Index'].toFixed(2)}</td>
                    <td>${row['Cash Withdrawal %'].toFixed(1)}%</td>
                    <td>${row['Recent Spend Change %'].toFixed(1)}%</td>
                    <td>${row['DPD Bucket Next Month']}</td>
                </tr>
            `).join('');
            
            updatePagination();
        }
        
        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            document.getElementById('page-info').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('prev-page').disabled = currentPage === 1;
            document.getElementById('next-page').disabled = currentPage === totalPages || totalPages === 0;
        }
        
        function updateDatasetInfo() {
            const total = datasetData.length;
            const filtered = filteredData.length;
            if (filtered === total) {
                document.getElementById('dataset-info').textContent = `Total records: ${total.toLocaleString()}`;
            } else {
                document.getElementById('dataset-info').textContent = `Showing ${filtered.toLocaleString()} of ${total.toLocaleString()} records`;
            }
        }
        
        // Download full dataset function
        async function downloadFullDataset(event) {
            try {
                // Check if running from file:// protocol (local file)
                const isLocalFile = window.location.protocol === 'file:';
                
                if (isLocalFile) {
                    alert('Cannot download dataset when opening HTML directly (file:// protocol).\n\nPlease use a local web server or access via GitHub Pages:\n- Python: python -m http.server 8000\n- Node: npx http-server\n- GitHub Pages: https://ashergrayne.github.io/Credit_Risk_HDFC_Capstone_Project/');
                    return;
                }
                
                // Show loading state
                const button = event ? event.target : document.querySelector('button[onclick*="downloadFullDataset"]');
                const originalText = button.innerHTML;
                button.innerHTML = '⏳ Downloading...';
                button.disabled = true;
                
                // Determine file path based on current dataset type
                const fileName = currentDatasetType === 'real' ? 'Sample.csv' : 'synthetic_dataset_50000.csv';
                const downloadFileName = currentDatasetType === 'real' ? 'Sample.csv' : 'synthetic_dataset_50000.csv';
                
                // Try multiple possible paths
                const possiblePaths = [
                    `data/${fileName}`,
                    `./data/${fileName}`,
                    `../data/${fileName}`
                ];
                
                let response = null;
                
                for (const path of possiblePaths) {
                    try {
                        response = await fetch(path);
                        if (response.ok) {
                            console.log(`Successfully loading dataset from: ${path}`);
                            break;
                        }
                    } catch (err) {
                        console.warn(`Failed to load from ${path}:`, err.message);
                        continue;
                    }
                }
                
                if (!response || !response.ok) {
                    throw new Error(`Failed to load dataset. Status: ${response ? response.status : 'No response'}`);
                }
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = downloadFileName;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                console.log(`Dataset download initiated successfully: ${downloadFileName}`);
                
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); z-index: 10000;';
                successMsg.textContent = '✅ Download started!';
                document.body.appendChild(successMsg);
                setTimeout(() => successMsg.remove(), 3000);
                
            } catch (error) {
                console.error('Error downloading dataset:', error);
                
                // Reset button
                const button = event.target;
                button.innerHTML = '📥 Download Full Dataset (50,000 records)';
                button.disabled = false;
                
                // Show error message
                alert('Failed to download dataset. Please check:\n\n1. File exists at: data/synthetic_dataset_50000.csv\n2. You are accessing via HTTP (not file://)\n3. Check browser console for details.');
            }
        }
        
        // Risk flags data for customer IDs
        let riskFlagsData = [];
        
        // Load risk flags data
        async function loadRiskFlagsData() {
            try {
                // Check if running from file:// protocol (local file)
                const isLocalFile = window.location.protocol === 'file:';
                
                if (isLocalFile) {
                    console.warn('Running from file:// protocol. CSV loading may be restricted by browser security.');
                    console.warn('For local testing, use a local web server:');
                    console.warn('  Python: python -m http.server 8000');
                    console.warn('  Node: npx http-server');
                    console.warn('  Then open: http://localhost:8000');
                }
                
                // Try multiple paths
                const possiblePaths = [
                    'data/risk_flags_output.csv',
                    './data/risk_flags_output.csv',
                    '../data/risk_flags_output.csv'
                ];
                
                let response = null;
                let loaded = false;
                let lastError = null;
                
                for (const path of possiblePaths) {
                    try {
                        response = await fetch(path);
                        if (response.ok) {
                            loaded = true;
                            console.log(`Successfully loaded CSV from: ${path}`);
                            break;
                        } else {
                            lastError = `HTTP ${response.status}`;
                        }
                    } catch (err) {
                        lastError = err.message;
                        console.warn(`Failed to load from ${path}:`, err.message);
                        continue;
                    }
                }
                
                if (!loaded || !response || !response.ok) {
                    const errorMsg = isLocalFile 
                        ? `Cannot load CSV file when opening HTML directly (file:// protocol). Please use a local web server or deploy to GitHub Pages. Last error: ${lastError || 'No response'}`
                        : `Failed to load CSV file. Status: ${response ? response.status : lastError || 'No response'}`;
                    throw new Error(errorMsg);
                }
                
                const text = await response.text();
                const lines = text.split('\n').filter(line => line.trim());
                
                if (lines.length === 0) {
                    console.error('Risk flags CSV file is empty');
                    return;
                }
                
                riskFlagsData = [];
                
                // Parse CSV manually to handle quoted fields with commas
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim()) {
                        try {
                            const values = parseCSVLine(lines[i]);
                            
                            // CSV structure: customer_id,risk_level,risk_score,flags,flag_count
                            if (values.length >= 5) {
                                const customerId = values[0]?.trim() || '';
                                const riskLevel = values[1]?.trim() || '';
                                const flagCountStr = values[4]?.trim() || '0';
                                const flagCount = parseInt(flagCountStr) || 0;
                                
                                // Skip header row and empty rows
                                if (customerId && customerId !== 'customer_id' && customerId !== '') {
                                    riskFlagsData.push({
                                        customer_id: customerId,
                                        risk_level: riskLevel,
                                        flag_count: flagCount,
                                        flags: values[3] || '[]'
                                    });
                                }
                            } else {
                                console.warn(`Line ${i + 1}: Expected 5 columns, got ${values.length}. First 3 values:`, values.slice(0, 3));
                            }
                        } catch (parseError) {
                            console.error(`Error parsing line ${i + 1}:`, parseError);
                            // Continue to next line
                        }
                    }
                }
                
                console.log(`Successfully loaded ${riskFlagsData.length} risk flag records`);
                
                // Verify data
                if (riskFlagsData.length > 0) {
                    console.log('Sample record:', riskFlagsData[0]);
                    const criticalCount = riskFlagsData.filter(r => r.risk_level === 'CRITICAL').length;
                    const highCount = riskFlagsData.filter(r => r.risk_level === 'HIGH').length;
                    const flaggedCount = riskFlagsData.filter(r => r.flag_count > 0).length;
                    console.log(`CRITICAL: ${criticalCount}, HIGH: ${highCount}, Flagged: ${flaggedCount}`);
                    
                    // Enable tile clicks by removing loading class if exists
                    document.querySelectorAll('.expandable-card').forEach(card => {
                        card.classList.remove('data-loading');
                    });
                } else {
                    console.warn('No risk flag records loaded!');
                }
            } catch (error) {
                console.error('Error loading risk flags data:', error);
                console.error('Error details:', error.message);
                
                // Set a flag so we know data failed to load
                riskFlagsData = null;
                
                // Show helpful error message
                const isLocalFile = window.location.protocol === 'file:';
                if (isLocalFile) {
                    console.error('%cIMPORTANT: You are opening the HTML file directly (file://).', 'color: red; font-weight: bold; font-size: 14px;');
                    console.error('%cBrowsers block local file access for security reasons.', 'color: red; font-weight: bold;');
                    console.error('%cSolutions:', 'color: orange; font-weight: bold;');
                    console.error('1. Use a local web server:');
                    console.error('   - Python: python -m http.server 8000');
                    console.error('   - Node.js: npx http-server');
                    console.error('   - Then open: http://localhost:8000');
                    console.error('2. Deploy to GitHub Pages (recommended for production)');
                } else {
                    console.error('Please check:');
                    console.error('1. File exists at: data/risk_flags_output.csv');
                    console.error('2. File is accessible via HTTP');
                    console.error('3. Check browser console Network tab for failed requests');
                }
            }
        }
        
        // Toggle customer IDs display in tile
        function toggleCustomerIds(cardElement, filterType) {
            const isExpanded = cardElement.classList.contains('expanded');
            const expandedContent = cardElement.querySelector('.card-expanded-content');
            const containerId = `customer-ids-${filterType}`;
            const container = document.getElementById(containerId);
            
            // Close all other expanded cards
            document.querySelectorAll('.expandable-card.expanded').forEach(card => {
                if (card !== cardElement) {
                    card.classList.remove('expanded');
                    card.querySelector('.card-expanded-content').style.display = 'none';
                }
            });
            
            if (isExpanded) {
                // Collapse
                cardElement.classList.remove('expanded');
                expandedContent.style.display = 'none';
            } else {
                // Expand
                cardElement.classList.add('expanded');
                expandedContent.style.display = 'block';
                
                // Show loading state
                container.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 1rem;">Loading customer IDs...</p>';
                
                // Load customer IDs if not already loaded
                if (!container.hasChildNodes() || container.textContent.trim() === '' || container.textContent.includes('Loading')) {
                    // Wait a bit for data to load if needed
                    if (!riskFlagsData || riskFlagsData.length === 0) {
                        // Data not loaded yet, wait and retry
                        setTimeout(() => {
                            loadCustomerIdsForCard(filterType, container);
                        }, 500);
                    } else {
                        loadCustomerIdsForCard(filterType, container);
                    }
                }
            }
        }
        
        // Load customer IDs for a specific card
        function loadCustomerIdsForCard(filterType, container) {
            // Check if data is loaded
            if (!riskFlagsData || riskFlagsData.length === 0) {
                container.innerHTML = '<p style="color: #ef4444; text-align: center; padding: 1rem;">Data still loading... Please wait a moment and try again.</p>';
                // Try to reload data
                loadRiskFlagsData().then(() => {
                    // Retry after data loads
                    if (riskFlagsData && riskFlagsData.length > 0) {
                        setTimeout(() => loadCustomerIdsForCard(filterType, container), 300);
                    } else {
                        container.innerHTML = '<p style="color: #ef4444; text-align: center; padding: 1rem;">Failed to load data. Please check console for errors.</p>';
                    }
                });
                return;
            }
            
            let customerIds = [];
            
            if (filterType === 'all') {
                // All flagged customers (flag_count > 0)
                customerIds = riskFlagsData
                    .filter(row => row.flag_count > 0)
                    .map(row => row.customer_id);
            } else if (filterType === 'CRITICAL') {
                // CRITICAL risk customers
                customerIds = riskFlagsData
                    .filter(row => row.risk_level === 'CRITICAL')
                    .map(row => row.customer_id);
            } else if (filterType === 'HIGH') {
                // HIGH risk customers
                customerIds = riskFlagsData
                    .filter(row => row.risk_level === 'HIGH')
                    .map(row => row.customer_id);
            } else if (filterType === 'top_flag') {
                // Customers with most flags (flag_count >= 4)
                // Sort by flag_count descending, then take customer_ids
                customerIds = riskFlagsData
                    .filter(row => row.flag_count >= 4)
                    .sort((a, b) => b.flag_count - a.flag_count)
                    .map(row => row.customer_id);
            }
            
            console.log(`Filter: ${filterType}, Found: ${customerIds.length} customers`);
            
            if (customerIds.length === 0) {
                container.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 1rem;">No customers found. (Data may still be loading)</p>';
            } else {
                container.innerHTML = customerIds.map(id => 
                    `<div class="customer-id-item">${id}</div>`
                ).join('');
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateStrategies();
            loadDataset();
            loadRiskFlagsData();
        });
    </script>
</body>
</html>
